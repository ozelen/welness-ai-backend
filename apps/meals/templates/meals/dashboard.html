{% extends "base.html" %}
{% load meal_extras %}

{% block title %}Meals Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Meals Dashboard</h1>
        <p class="text-gray-600">Manage your diets, meals, and food preferences</p>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Total Diets</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ diets.count }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-green-100 text-green-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Food Preferences</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ preference_summary.total }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-purple-100 text-purple-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-600">Recent Meals</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ recent_meals.count }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Preference Summary -->
    <div class="bg-white rounded-lg shadow mb-8">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">Food Preferences Summary</h2>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-2 md:grid-cols-6 gap-4">
                {% for pref_type, pref_label in preference_types %}
                <div class="text-center">
                    <div class="text-2xl font-bold text-gray-900">{{ preference_summary.by_type|default:0|get_item:pref_type|default:0 }}</div>
                    <div class="text-sm text-gray-600">{{ pref_label }}</div>
                </div>
                {% endfor %}
            </div>
            <div class="mt-6">
                <a href="{% url 'meals:preferences-page' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                    Manage Preferences
                </a>
            </div>
        </div>
    </div>

    <!-- Recent Preferences -->
    {% if preferences %}
    <div class="bg-white rounded-lg shadow mb-8">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">Recent Food Preferences</h2>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                {% for preference in preferences %}
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full 
                            {% if preference.preference_type == 'love' %}bg-red-500
                            {% elif preference.preference_type == 'like' %}bg-green-500
                            {% elif preference.preference_type == 'dislike' %}bg-yellow-500
                            {% elif preference.preference_type == 'hate' %}bg-red-700
                            {% elif preference.preference_type == 'restriction' %}bg-orange-500
                            {% elif preference.preference_type == 'allergy' %}bg-red-800
                            {% endif %}">
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-900">{{ preference.ingredient.name }}</p>
                            <p class="text-sm text-gray-500">{{ preference.get_preference_type_display }}</p>
                        </div>
                    </div>
                    {% if preference.description %}
                    <p class="text-sm text-gray-600">{{ preference.description }}</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Recent Meals -->
    {% if recent_meals %}
    <div class="bg-white rounded-lg shadow">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-xl font-semibold text-gray-900">Recent Meals</h2>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                {% for meal_record in recent_meals %}
                <div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg">
                    <div>
                        <p class="text-sm font-medium text-gray-900">{{ meal_record.meal.name }}</p>
                        <p class="text-sm text-gray-500">{{ meal_record.timestamp|date:"M d, Y H:i" }}</p>
                    </div>
                    {% if meal_record.feedback %}
                    <p class="text-sm text-gray-600">{{ meal_record.feedback }}</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div class="mt-8 flex flex-wrap gap-4">
        <a href="{% url 'meals:ingredients-page' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            Browse Ingredients
        </a>
        <a href="{% url 'meals:meal-list' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            View Meals
        </a>
        <a href="{% url 'meals:diet-list' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            Manage Diets
        </a>
    </div>
</div>
{% endblock %} 